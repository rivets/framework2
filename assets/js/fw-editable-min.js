var fweditable={popover:null,inline:null,domid:-1,edOptions:[],emptyText:"--------",makeEdit:function(e){const t=fweditable.edOptions[e.getAttribute("data-editable-id")];let i,o=e.innerHTML;switch(o===t.emptyText&&(o=""),t.type){case"select":i='<select class="edbox">',"function"==typeof t.source&&(t.source=t.source());for(let e of t.source)if("object"==typeof e){let t=e.value;t instanceof String&&t.includes('"')&&(t=t.replace(/"/,"&quot;")),i+='<option value="'+t+'"'+(e.text==o?" selected":"")+">"+e.text+"</option>"}else i+="<option"+(e==o?" selected":"")+">"+e+"</option>";i+="</select>";break;case"textarea":i='<textarea rows="5" cols="80" class="edbox">'+o+"</textarea>";break;case"text":o.includes('"')&&(o=o.replace(/"/,"&quot;")),i='<form id="edboxfrm"><input type="'+t.type+'" value="'+o+'" class="edbox"/></form>';break;default:o.includes('"')&&(o=o.replace(/"/,"&quot;")),i='<input type="'+t.type+'" value="'+o+'" class="edbox"/>';break}return i+'<i class="fa-solid fa-circle-xmark edno"></i><i class="fa-solid fa-circle-check edyes"></i>'},popDispose:function(){document.body.removeEventListener("click",fweditable.outsideClick),null!==fweditable.popover&&(fweditable.popover.dispose(),fweditable.popover=null)},outsideClick:function(e){fweditable.inline==e.target||fweditable.inline==fweditable.popover.tip||fweditable.popover.tip.contains(e.target)||fweditable.popDispose(e)},editUpdate:function(e,t){return framework.ajax(framework.buildFWLink("ajax",e.op,e.bean,e.key,e.field),{method:framework.putorpatch,data:{value:t}})},popClick:function(e){if(e.classList.contains("disabled"))return;const t=fweditable.edOptions[e.getAttribute("data-editable-id")],i=t.type,o=t.title;null!==fweditable.inline&&fweditable.popDispose();let l=new bootstrap.Popover(e,{title:o,container:"body",html:!0,sanitize:!1,content:fweditable.makeEdit(e),placement:"auto",template:'<div class="popover pop'+i+'" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'});l.show();let a=l.tip;e.addEventListener("shown.bs.popover",(function(e){fwdom.stop(e);const t=document.querySelector(".popover").querySelector(".edbox");t.focus({preventScroll:!0}),"SELECT"!=t.nodeName&&t.setSelectionRange(1e5,1e5)})),"text"==i&&document.getElementById("edboxfrm").addEventListener(isEnter),a.querySelector(".edno").addEventListener("click",fweditable.popDispose),a.querySelector(".edyes").addEventListener("click",(function(e){fwdom.stop(e);let t=fweditable.edOptions[fweditable.inline.getAttribute("data-editable-id")],i=a.querySelector(".edbox");i.value!=fweditable.inline.innerHTML&&(null==t.update?framework.alert("No update function defined"):t.update(t,i.value).done((function(){if("select"==t.type){for(let e of t.source)if("object"==typeof e){if(i.value==e.value){fweditable.inline.innerText=e.text;break}}else if(i.value==e){fweditable.inline.innerText=e;break}}else""===i.value?(fweditable.inline.innerText=t.emptyText,fweditable.inline.classList.add("edempty")):(fweditable.inline.innerText=i.value,fweditable.inline.classList.remove("edempty"))})).fail((function(){framework.alert("Update failed")}))),fweditable.popDispose()})),document.body.addEventListener("click",fweditable.outsideClick),fweditable.popover=l,fweditable.inline=e},isEnter:function(){alert("ENTER")},editable:function(e,t=null){let i={type:"text",emptyText:fweditable.emptyText,title:"Edit String",update:null};if(null!=t)for(let e in t)i[e]=t[e];let o=e.dataset;for(let e in o)i[e]=o[e];fweditable.domid+=1,fweditable.edOptions[fweditable.domid]=i,e.setAttribute("data-editable-id",fweditable.domid),""===e.innerHTML&&(e.innerHTML=i.emptyText,e.classList.add("edempty")),e.addEventListener("click",(function(e){fwdom.stop(e);const t=this.getAttribute("data-editable-id"),i=fweditable.edOptions[t],o=this;"string"==typeof i.source?framework.getJSON(i.source,(function(e){fweditable.edOptions[t].source=e,fweditable.popClick(o)}),(function(){framework.alert("Cannot fetch list")}),!1):fweditable.popClick(o)}))}};
//# sourceMappingURL=fw-editable-min.js.map