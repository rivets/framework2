var fweditable={popover:null,inline:null,domid:-1,edOptions:[],emptyText:"--------",makeEdit:function(e){const t=fweditable.edOptions[e.getAttribute("data-editable-id")];let i=e.innerText,o;switch(i===t.emptyText&&(i=""),t.type){case"select":o='<select class="edbox">',"function"==typeof t.source&&(t.source=t.source());for(let e of t.source)o+="object"==typeof e?'<option value="'+e.value+'"'+(e.text==i?" selected":"")+">"+e.text+"</option>":"<option"+(e==i?" selected":"")+">"+e+"</option>";o+="</select>";break;case"textarea":o='<textarea rows="5" cols="80" class="edbox">'+i+"</textarea>";break;default:o='<input type="'+t.type+'" value="'+i+'" class="edbox"/>';break}return o+'<i class="fas fa-times-circle edno"></i><i class="fas fa-check-circle edyes"></i>'},popDispose:function(){document.body.removeEventListener("click",fweditable.outsideClick),null!==fweditable.popover&&(fweditable.popover.dispose(),fweditable.popover=null)},outsideClick:function(e){fwdom.inline==e.target||fwdom.inline==fwdom.popover.tip||fwdom.popover.tip.contains(e.target)||fweditable.popDispose(e)},editUpdate:function(e,t){return framework.ajax(framework.buildFWLink("ajax",e.op,e.bean,e.key,e.field),{method:putorpatch,data:{value:t}})},popClick:function(e){if(e.hasAttribute("disabled"))return;const t=fweditable.edOptions[e.getAttribute("data-editable-id")],i=t.type,o=t.title;null!==fweditable.inline&&fweditable.popDispose();let l=new bootstrap.Popover(e,{title:o,container:"body",html:!0,sanitize:!1,content:fweditable.makeEdit(e),placement:"auto",template:'<div class="popover pop'+i+'" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'});l.show();let d=l.tip;d.querySelector(".edno").addEventListener("click",fwdom.popDispose),d.querySelector(".edyes").addEventListener("click",(function(e){fwdom.stop(e);let t=fweditable.edOptions[fwdom.inline.getAttribute("data-editable-id")],i=d.querySelector(".edbox");i.value!=fweditable.inline.innerText&&(null==t.update?fwdom.alert("No update function defined"):t.update(t,i.value).done((function(){if("select"==t.type){for(let e of t.source)if("object"==typeof e){if(i.value==e.value){fweditable.inline.innerText=e.text;break}}else if(i.value==e){fweditable.inline.innerText=e;break}}else""===i.value?(fweditable.inline.innerText=t.emptytext,fweditable.inline.classList.add("edempty")):(fweditable.inline.innerText=i.value,fweditable.inline.classList.remove("edempty"))})).fail((function(e){fwdom.alert("Update failed")}))),fweditable.popDispose()})),document.body.addEventListener("click",fweditable.outsideClick),fweditable.popover=l,fweditable.inline=e},editable:function(e,t=null){let i={type:"text",emptyText:fweditable.emptyText,title:"Edit String",update:null};if(null!=t)for(let e in t)i[e]=t[e];let o=e.dataset;for(let e in o)i[e]=o[e];fweditable.domid+=1,fweditable.edOptions[fwdom.domid]=i,e.setAttribute("data-editable-id",fweditable.domid),""===e.innerText&&(e.innerText=i.emptyText,e.classList.add("edempty")),e.addEventListener("click",(function(e){fwdom.stop(e);const t=this.getAttribute("data-editable-id"),i=fweditable.edOptions[t],o=this;"string"==typeof i.source?framework.getJSON(i.source,(function(e){fweditable.edOptions[t].source=e,fweditable.popClick(o)}),(function(e){fwdom.alert("Cannot fetch list")}),!1):fweditable.popClick(o)}))}};
//# sourceMappingURL=fw-editable-min.js.map