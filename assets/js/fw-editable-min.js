fwdom.popover=null,fwdom.inline=null,fwdom.domid=-1,fwdom.edOptions=[],fwdom.makeEdit=function(e){console.log(this);const t=fwdom.edOptions[e.getAttribute("data-editable-id")];let o=e.innerText,i;switch(o===t.emptyText&&(o=""),t.type){case"select":i='<select class="edbox">',"function"==typeof t.source&&(t.source=t.source());for(let e of t.source)i+="object"==typeof e?'<option value="'+e.value+'"'+(e.text==o?" selected":"")+">"+e.text+"</option>":"<option"+(e==o?" selected":"")+">"+e+"</option>";i+="</select>";break;case"textarea":i='<textarea rows="5" cols="80" class="edbox">'+o+"</textarea>";break;default:i='<input type="'+t.type+'" value="'+o+'" class="edbox"/>';break}return i+'<i class="fas fa-times-circle edno"></i><i class="fas fa-check-circle edyes"></i>'},fwdom.popDispose=function(){document.body.removeEventListener("click",fwdom.outsideClick),null!==fwdom.popover&&(fwdom.popover.dispose(),fwdom.popover=null)},fwdom.outsideClick=function(e){fwdom.inline==e.target||fwdom.inline==fwdom.popover.tip||fwdom.popover.tip.contains(e.target)||fwdom.popDispose(e)},fwdom.editUpdate=function(e,t){return framework.ajax(framework.buildFWLink("ajax",e.op,e.bean,e.key,e.field),{method:putorpatch,data:{value:t}})},fwdom.popClick=function(e){if(e.hasAttribute("disabled"))return;const t=fwdom.edOptions[e.getAttribute("data-editable-id")].type,o=fwdom.edOptions[e.getAttribute("data-editable-id")].title;null!==fwdom.inline&&fwdom.popDispose();let i=new bootstrap.Popover(e,{title:o,container:"body",html:!0,sanitize:!1,content:fwdom.makeEdit(e),placement:"auto",template:'<div class="popover pop'+t+'" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'});i.show();let d=i.tip;d.querySelector(".edno").addEventListener("click",fwdom.popDispose),d.querySelector(".edyes").addEventListener("click",(function(e){fwdom.stop(e);let t=fwdom.edOptions[fwdom.inline.getAttribute("data-editable-id")],o=d.querySelector(".edbox");o.value!=fwdom.inline.innerText&&(null==t.update?fwdom.alert("No update function defined"):t.update(t,o.value).done((function(e){console.log(e),""===o.value?(fwdom.inline.innerText=t.emptytext,fwdom.inline.classList.add("edempty")):(fwdom.inline.innerText=o.value,fwdom.inline.classList.remove("edempty"))})).fail((function(e){console.log(e),fwdom.alert("Update failed")}))),fwdom.popDispose()})),document.body.addEventListener("click",fwdom.outsideClick),fwdom.popover=i,fwdom.inline=this},fwdom.editable=function(e,t=null){let o={type:"text",emptyText:"------",title:"Edit String",update:null};if(null!=t)for(let e in t)o[e]=t[e];let i=e.dataset;for(let e in i)o[e]=i[e];fwdom.domid+=1,fwdom.edOptions[fwdom.domid]=o,e.setAttribute("data-editable-id",fwdom.domid),""===e.innerText&&(e.innerText=o.emptyText,e.classList.add("edempty")),e.addEventListener("click",(function(e){fwdom.stop(e);const t=this.getAttribute("data-editable-id"),o=fwdom.edOptions[t],i=this;"string"==typeof o.source?framework.getJSON(o.source,(function(e){fwdom.edOptions[t].source=e,fwdom.popClick(i)}),(function(e){fwdom.alert("Cannot fetch list")}),!1):fwdom.popClick(i)}))};
//# sourceMappingURL=fw-editable-min.js.map